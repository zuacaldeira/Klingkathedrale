<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Entdecke Bach — Klangkathedrale</title>
<meta name="description" content="Ihre persönliche Bach-Reise — im Geist Helmuth Rillings">
<meta name="theme-color" content="#C9A84C">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,opsz,wght@0,6..96,400;0,6..96,700;0,6..96,900;1,6..96,400;1,6..96,700&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400;1,600&family=EB+Garamond:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<link rel="manifest" href="manifest.json">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --color-gold:#C9A84C;--color-ink:#1A1410;--color-ivory:#F5F0E8;--color-parchment:#EDE6D6;
  --font-display:'Bodoni Moda',serif;--font-body:'Cormorant Garamond',serif;--font-serif:'EB Garamond',serif;
}
html{scroll-behavior:smooth}
body{background:var(--color-ink);color:var(--color-ivory);font-family:var(--font-body);line-height:1.7;min-height:100vh;overflow-x:hidden}

/* Nav */
.top-nav{position:fixed;top:0;left:0;right:0;z-index:100;padding:1rem 2rem;background:rgba(26,20,16,0.95);backdrop-filter:blur(10px);display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(201,168,76,0.1)}
.top-nav a{color:rgba(245,240,232,0.6);text-decoration:none;font-family:var(--font-body);font-size:0.95rem;transition:color 0.3s}
.top-nav a:hover{color:var(--color-gold)}
.top-nav .logo{color:var(--color-gold);font-family:var(--font-display);letter-spacing:0.1em;font-size:1.1rem}

/* Main container */
.container{max-width:800px;margin:0 auto;padding:6rem 2rem 4rem;min-height:100vh;display:flex;flex-direction:column;justify-content:center}

/* States */
.state{display:none;opacity:0;transition:opacity 0.8s ease}
.state.active{display:block;opacity:1}

/* Welcome */
.welcome-title{font-family:var(--font-display);font-size:clamp(2rem,5vw,3rem);color:var(--color-gold);font-weight:400;text-align:center;margin-bottom:0.5rem}
.welcome-sub{font-family:var(--font-body);font-style:italic;font-size:1.2rem;color:rgba(245,240,232,0.5);text-align:center;margin-bottom:3rem}
.welcome-quote{font-family:var(--font-body);font-style:italic;font-size:1.1rem;color:rgba(245,240,232,0.4);text-align:center;max-width:500px;margin:0 auto 3rem;line-height:1.8}
.start-btn{display:block;margin:0 auto;padding:1rem 3rem;font-family:var(--font-body);font-size:1.1rem;letter-spacing:0.15em;text-transform:uppercase;color:var(--color-gold);background:transparent;border:1px solid rgba(201,168,76,0.4);cursor:pointer;transition:all 0.4s}
.start-btn:hover{background:rgba(201,168,76,0.1);border-color:var(--color-gold)}

/* Question */
.q-number{font-family:var(--font-body);font-size:0.85rem;letter-spacing:0.3em;text-transform:uppercase;color:rgba(201,168,76,0.5);text-align:center;margin-bottom:1rem}
.q-text{font-family:var(--font-display);font-size:clamp(1.5rem,4vw,2.2rem);color:var(--color-gold);font-weight:400;text-align:center;margin-bottom:2.5rem;line-height:1.4}
.options{display:flex;flex-direction:column;gap:0.75rem;max-width:400px;margin:0 auto}
.option-btn{padding:1rem 1.5rem;font-family:var(--font-body);font-size:1.1rem;color:var(--color-ivory);background:rgba(201,168,76,0.03);border:1px solid rgba(201,168,76,0.15);cursor:pointer;transition:all 0.3s;text-align:center}
.option-btn:hover{border-color:var(--color-gold);background:rgba(201,168,76,0.08);transform:translateY(-2px)}

/* Loading */
.loading-text{font-family:var(--font-body);font-style:italic;font-size:1.3rem;color:rgba(245,240,232,0.5);text-align:center}
.loading-dots::after{content:'';animation:dots 1.5s infinite}
@keyframes dots{0%{content:''}33%{content:'.'}66%{content:'..'}100%{content:'...'}}
.loading-notes{text-align:center;font-size:2rem;color:var(--color-gold);margin-top:2rem;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:0.3}50%{opacity:1}}

/* Results */
.results-header{text-align:center;margin-bottom:3rem}
.results-title{font-family:var(--font-display);font-size:1.8rem;color:var(--color-gold);font-weight:400;margin-bottom:0.5rem}
.results-sub{font-family:var(--font-body);font-style:italic;font-size:1rem;color:rgba(245,240,232,0.4)}
.result-card{border:1px solid rgba(201,168,76,0.15);padding:2rem;margin-bottom:1.5rem;opacity:0;transform:translateY(20px);transition:all 0.8s ease}
.result-card.visible{opacity:1;transform:translateY(0)}
.result-card:hover{border-color:rgba(201,168,76,0.4);background:rgba(201,168,76,0.02)}
.card-bwv{font-family:var(--font-serif);font-size:0.85rem;color:var(--color-gold);letter-spacing:0.1em;margin-bottom:0.3rem}
.card-title{font-family:var(--font-display);font-size:1.4rem;font-style:italic;color:var(--color-ivory);margin-bottom:0.5rem;font-weight:400}
.card-desc{font-family:var(--font-body);font-style:italic;font-size:1.05rem;color:rgba(245,240,232,0.6);margin-bottom:1rem;line-height:1.7}
.card-why{font-family:var(--font-body);font-size:0.95rem;color:rgba(245,240,232,0.5);margin-bottom:1rem;line-height:1.7}
.card-recording{font-family:var(--font-serif);font-size:0.85rem;color:rgba(201,168,76,0.6);margin-bottom:0.5rem}
.card-tip{font-family:var(--font-body);font-size:0.9rem;color:rgba(245,240,232,0.4);font-style:italic}
.card-actions{display:flex;gap:1rem;margin-top:1.5rem;flex-wrap:wrap}
.listen-btn{padding:0.6rem 1.5rem;font-family:var(--font-body);font-size:0.95rem;color:var(--color-gold);background:transparent;border:1px solid rgba(201,168,76,0.3);cursor:pointer;text-decoration:none;transition:all 0.3s;letter-spacing:0.05em}
.listen-btn:hover{background:rgba(201,168,76,0.1);border-color:var(--color-gold)}
.expand-btn{padding:0.6rem 1.5rem;font-family:var(--font-body);font-size:0.95rem;color:rgba(245,240,232,0.4);background:transparent;border:1px solid rgba(245,240,232,0.1);cursor:pointer;transition:all 0.3s}
.expand-btn:hover{color:var(--color-ivory);border-color:rgba(245,240,232,0.3)}
.deep-dive{display:none;margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid rgba(201,168,76,0.1)}
.deep-dive.open{display:block;animation:fadeIn 0.5s ease}
.deep-dive p{font-family:var(--font-body);font-size:0.95rem;color:rgba(245,240,232,0.5);line-height:1.8;margin-bottom:1rem}
.deep-dive h4{font-family:var(--font-display);font-size:1rem;color:var(--color-gold);font-weight:400;margin-bottom:0.5rem}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.restart-btn{display:block;margin:2rem auto 0;padding:1rem 2.5rem;font-family:var(--font-body);font-size:1rem;letter-spacing:0.1em;color:var(--color-gold);background:transparent;border:1px solid rgba(201,168,76,0.3);cursor:pointer;transition:all 0.3s}
.restart-btn:hover{background:rgba(201,168,76,0.1);border-color:var(--color-gold)}

/* Footer */
.footer{text-align:center;padding:3rem 2rem 2rem;margin-top:2rem}
.footer a{color:var(--color-gold);text-decoration:none;font-family:var(--font-body);font-size:0.9rem}
.footer p{font-size:0.8rem;color:rgba(245,240,232,0.2);margin-top:1rem}

@media(max-width:600px){
  .container{padding:5rem 1.25rem 3rem}
  .result-card{padding:1.5rem}
  .card-actions{flex-direction:column}
}
</style>
</head>
<body>

<nav class="top-nav">
  <a href="klangkathedrale.html" class="logo">Klangkathedrale</a>
  <a href="klangkathedrale.html">&larr; Zurück</a>
</nav>

<div class="container">
  <!-- WELCOME -->
  <div class="state active" id="welcome">
    <div class="welcome-title">Entdecke Bach</div>
    <div class="welcome-sub">mit Helmuth Rilling</div>
    <p class="welcome-quote">
      &bdquo;Musik muss die Menschen aufschrecken und tief in sie hineingehen.&ldquo;
      <br><small style="color:rgba(245,240,232,0.3)">— Helmuth Rilling</small>
    </p>
    <button class="start-btn" onclick="startJourney()">Reise beginnen</button>
  </div>

  <!-- QUESTIONS -->
  <div class="state" id="q1">
    <div class="q-number">Frage 1 von 3</div>
    <div class="q-text">Wie fühlen Sie sich gerade?</div>
    <div class="options">
      <button class="option-btn" onclick="answer(0,'friedlich')">Friedlich</button>
      <button class="option-btn" onclick="answer(0,'energiegeladen')">Energiegeladen</button>
      <button class="option-btn" onclick="answer(0,'nachdenklich')">Nachdenklich</button>
      <button class="option-btn" onclick="answer(0,'traurig')">Traurig</button>
      <button class="option-btn" onclick="answer(0,'neugierig')">Neugierig</button>
    </div>
  </div>
  <div class="state" id="q2">
    <div class="q-number">Frage 2 von 3</div>
    <div class="q-text">Kennen Sie klassische Musik?</div>
    <div class="options">
      <button class="option-btn" onclick="answer(1,'neuling')">Neuling</button>
      <button class="option-btn" onclick="answer(1,'etwas')">Etwas</button>
      <button class="option-btn" onclick="answer(1,'kenner')">Kenner</button>
      <button class="option-btn" onclick="answer(1,'musiker')">Musiker</button>
    </div>
  </div>
  <div class="state" id="q3">
    <div class="q-number">Frage 3 von 3</div>
    <div class="q-text">Was berührt Sie in Kunst?</div>
    <div class="options">
      <button class="option-btn" onclick="answer(2,'schoenheit')">Schönheit</button>
      <button class="option-btn" onclick="answer(2,'drama')">Drama</button>
      <button class="option-btn" onclick="answer(2,'tiefe')">Tiefe</button>
      <button class="option-btn" onclick="answer(2,'virtuositaet')">Virtuosität</button>
      <button class="option-btn" onclick="answer(2,'stille')">Stille</button>
    </div>
  </div>

  <!-- LOADING -->
  <div class="state" id="loading">
    <p class="loading-text">Ihre Bach-Reise wird zusammengestellt<span class="loading-dots"></span></p>
    <div class="loading-notes">&#9835; &#9834; &#9835;</div>
  </div>

  <!-- RESULTS -->
  <div class="state" id="results"></div>
</div>

<script type="module">
import { SETS, getSetKey } from './src/lib/quiz.js';
const answers = [null, null, null];

// SETS and getSetKey imported from src/lib/quiz.js

function showState(id) {
  document.querySelectorAll('.state').forEach(s => {
    s.classList.remove('active');
    s.style.display = 'none';
  });
  const el = document.getElementById(id);
  el.style.display = 'block';
  setTimeout(() => el.classList.add('active'), 50);
}

function startJourney() { showState('q1'); }

function answer(qIndex, value) {
  answers[qIndex] = value;
  if (qIndex === 0) showState('q2');
  else if (qIndex === 1) showState('q3');
  else {
    showState('loading');
    setTimeout(showResults, 2000);
  }
}

function showResults() {
  const moodMap = {friedlich:'peaceful',energiegeladen:'energized',nachdenklich:'contemplative',traurig:'sad',neugierig:'curious'};
  const aestheticMap = {schoenheit:'beauty',drama:'drama',tiefe:'depth',virtuositaet:'virtuosity',stille:'stillness'};
  const mood = moodMap[answers[0]] || 'peaceful';
  const aesthetic = aestheticMap[answers[2]] || 'beauty';
  const key = getSetKey(mood, aesthetic);
  const set = SETS[key];

  let html = '<div class="results-header"><div class="results-title">Ihre Bach-Reise</div>';
  html += '<div class="results-sub">Drei Werke, ausgewählt im Geist Helmuth Rillings</div></div>';

  set.works.forEach((w, i) => {
    const ytQuery = encodeURIComponent('Helmuth Rilling ' + w.title + ' ' + w.bwv);
    html += `<div class="result-card" style="transition-delay:${i * 0.3}s" data-idx="${i}">
      <div class="card-bwv">${w.bwv}</div>
      <div class="card-title">${w.title}</div>
      <div class="card-desc">${w.desc}</div>
      <div class="card-why">${w.why}</div>
      <div class="card-recording">${w.recording}</div>
      <div class="card-tip">${w.tip}</div>
      <div class="card-actions">
        <a href="https://www.youtube.com/results?search_query=${ytQuery}" target="_blank" rel="noopener" class="listen-btn">Anhören &rarr;</a>
        <button class="expand-btn" onclick="toggleDeep(this)">Mehr erfahren</button>
      </div>
      <div class="deep-dive">
        <h4>Hintergrund</h4>
        <p>${w.deep}</p>
      </div>
    </div>`;
  });

  html += '<button class="restart-btn" onclick="restart()">Neue Reise beginnen</button>';
  html += '<div class="footer"><a href="klangkathedrale.html">Zurück zur Klangkathedrale</a><p>&copy; 2026 Klangkathedrale</p></div>';

  document.getElementById('results').innerHTML = html;
  showState('results');

  // Animate cards in
  setTimeout(() => {
    document.querySelectorAll('.result-card').forEach((card, i) => {
      setTimeout(() => card.classList.add('visible'), i * 300 + 100);
    });
  }, 100);
}

function toggleDeep(btn) {
  const dive = btn.closest('.result-card').querySelector('.deep-dive');
  dive.classList.toggle('open');
  btn.textContent = dive.classList.contains('open') ? 'Weniger anzeigen' : 'Mehr erfahren';
}

function restart() {
  answers[0] = answers[1] = answers[2] = null;
  showState('welcome');
}
</script>
<script>if('serviceWorker' in navigator)navigator.serviceWorker.register('sw.js');</script>
</body>
</html>
